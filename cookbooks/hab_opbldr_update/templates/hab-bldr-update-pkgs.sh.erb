#!/bin/bash

# This file is managed by Chef, any manual changes will be overwritten
# Used to update On-Prem Habitat Builder packages

# Download packages from source builder, specified within seed file
export HAB_AUTH_TOKEN="<%= @jobdetails['srcbldrpat'] %>"
hab pkg download --url <%= @jobdetails['srcbldrurl']%> --file <%= @jobdetails['seedfile'] %> --download-directory <%= @jobdetails['tmppath'] %>

# Bulk-Upload packages to target Habitat Builder
export HAB_AUTH_TOKEN="<%= @jobdetails['tgtbldrpat'] %>"
hab pkg bulkupload --url <%= @jobdetails['tgtbldrurl'] %> --channel <%= @jobdetails['tgtchannel'] %> <%= @jobdetails['tmppath'] %> 

# Cleanup
unset HAB_AUTH_TOKEN
rm -fr <%= @jobdetails['tmppath'] %>
