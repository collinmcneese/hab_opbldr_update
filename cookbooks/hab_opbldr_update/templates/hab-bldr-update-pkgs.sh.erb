#!/bin/bash

# This file is managed by Chef, any manual changes will be overwritten
# Used to update On-Prem Habitat Builder packages

# Download packages from source builder, specified within seed file
export HAB_AUTH_TOKEN="<%= @usertoml['opbldr']['srcbldrpat'] %>"
hab pkg download --url <%= @usertoml['opbldr']['srcbldrurl']%> --file <%= @usertoml['opbldr']['seedfilelist'] %> --download-directory <%= @usertoml['opbldr']['tmppath'] %>

# Bulk-Upload packages to target Habitat Builder
export HAB_AUTH_TOKEN="<%= @usertoml['opbldr']['tgtbldrpat'] %>"
hab pkg bulkupload --url <%= @usertoml['opbldr']['tgtbldrurl'] %> --channel stable <%= @usertoml['opbldr']['tmppath'] %> 

# Cleanup
unset HAB_AUTH_TOKEN
rm -fr <%= @usertoml['opbldr']['tmppath'] %>
